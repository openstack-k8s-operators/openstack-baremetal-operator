#cloud-config
hostname: {{ .HostName }}
# overwrite the fqdn set by metal3 with the one generated by the baremetalset
fqdn: {{ .FQDN }}
users:
  - name: {{ .CloudUserName }}
    ssh_authorized_keys:
{{ range $ssh_key := .AuthorizedKeys }}
{{ if not (eq $ssh_key "") }}
      - {{ $ssh_key }}
{{ end }}
{{ end }}
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    shell: /bin/bash
{{- if (index . "NodeRootPassword") }}
chpasswd:
  list: |
    root:{{ .NodeRootPassword }}
  expire: False
{{- end }}
bootcmd:
  # fix BLS entries
  - set -x; if [ -e /boot/loader/entries/ffffffffffffffffffffffffffffffff-* ]; then MACHINEID=$(cat /etc/machine-id) && rename "ffffffffffffffffffffffffffffffff" "$MACHINEID" /boot/loader/entries/ffffffffffffffffffffffffffffffff-* ; fi
